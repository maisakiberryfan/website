<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Songlist JSON è½‰æ›å·¥å…·</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container { max-width: 1000px; }
        .json-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .btn-download {
            background-color: #28a745;
            border-color: #28a745;
        }
        .btn-download:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">ğŸµ Songlist JSON è½‰æ›å·¥å…·</h1>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">ğŸ“‹ ä½¿ç”¨èªªæ˜</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>åŸå§‹æ ¼å¼:</strong></p>
                        <code>[{"songID": "1", "songName": "adrenaline!!!", "artist": "TrySail", "genre": "ã‚¢ãƒ‹ã‚½ãƒ³", ...}, ...]</code>
                        <p class="mt-2"><strong>è½‰æ›å¾Œæ ¼å¼:</strong></p>
                        <code>{"adrenaline!!!": "TrySail", ...}</code>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">ğŸ“ è¼¸å…¥åŸå§‹ JSON</h5>
                            </div>
                            <div class="card-body">
                                <textarea
                                    id="inputJson"
                                    class="form-control"
                                    rows="15"
                                    placeholder="è«‹è²¼å…¥åŸå§‹ JSON é™£åˆ—...&#10;ä¾‹å¦‚:&#10;[&#10;  {&#10;    &quot;songID&quot;: &quot;1&quot;,&#10;    &quot;songName&quot;: &quot;adrenaline!!!&quot;,&#10;    &quot;artist&quot;: &quot;TrySail&quot;,&#10;    &quot;genre&quot;: &quot;ã‚¢ãƒ‹ã‚½ãƒ³&quot;&#10;  }&#10;]"
                                ></textarea>
                                <div class="mt-3">
                                    <button id="convertBtn" class="btn btn-primary">ğŸ”„ è½‰æ›æ ¼å¼</button>
                                    <button id="clearBtn" class="btn btn-outline-secondary ms-2">ğŸ—‘ï¸ æ¸…ç©º</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">ğŸ“Š è½‰æ›çµæœ</h5>
                                <span id="songCount" class="badge bg-info">0 é¦–æ­Œæ›²</span>
                            </div>
                            <div class="card-body">
                                <pre id="outputJson" class="json-display p-3 mb-3">è½‰æ›çµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡...</pre>
                                <div>
                                    <button id="downloadBtn" class="btn btn-download" disabled>
                                        ğŸ“¥ ä¸‹è¼‰ songlist.json
                                    </button>
                                    <button id="copyBtn" class="btn btn-outline-primary ms-2" disabled>
                                        ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼æ¿
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info mt-4">
                    <h6><strong>ğŸ“Œ æ³¨æ„äº‹é …:</strong></h6>
                    <ul class="mb-0">
                        <li>åªæœƒæå– <code>songName</code> å’Œ <code>artist</code> æ¬„ä½</li>
                        <li>ç¼ºå°‘ä»»ä¸€æ¬„ä½çš„é …ç›®æœƒè¢«è·³é</li>
                        <li>è½‰æ›å¾Œä¿æŒåŸå§‹é †åºï¼Œä¸æœƒæ’åº</li>
                        <li>ä¸‹è¼‰æª”æ¡ˆå¾Œè«‹æ‰‹å‹•æ›¿æ› <code>worker/src/songlist.json</code></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SonglistConverter {
            constructor() {
                this.initElements();
                this.bindEvents();
            }

            initElements() {
                this.inputJson = document.getElementById('inputJson');
                this.outputJson = document.getElementById('outputJson');
                this.convertBtn = document.getElementById('convertBtn');
                this.downloadBtn = document.getElementById('downloadBtn');
                this.copyBtn = document.getElementById('copyBtn');
                this.clearBtn = document.getElementById('clearBtn');
                this.songCount = document.getElementById('songCount');
            }

            bindEvents() {
                this.convertBtn.addEventListener('click', () => this.convertJson());
                this.downloadBtn.addEventListener('click', () => this.downloadFile());
                this.copyBtn.addEventListener('click', () => this.copyToClipboard());
                this.clearBtn.addEventListener('click', () => this.clearInput());
            }

            convertJson() {
                const input = this.inputJson.value.trim();

                if (!input) {
                    this.showError('è«‹è¼¸å…¥ JSON è³‡æ–™');
                    return;
                }

                try {
                    const inputData = JSON.parse(input);

                    if (!Array.isArray(inputData)) {
                        this.showError('è¼¸å…¥å¿…é ˆæ˜¯ JSON é™£åˆ—æ ¼å¼');
                        return;
                    }

                    const converted = this.performConversion(inputData);
                    this.displayResult(converted);

                } catch (error) {
                    this.showError('JSON æ ¼å¼éŒ¯èª¤: ' + error.message);
                }
            }

            performConversion(inputArray) {
                const result = {};
                let processedCount = 0;
                let skippedCount = 0;

                inputArray.forEach((song, index) => {
                    if (song.songName && song.artist) {
                        result[song.songName] = song.artist;
                        processedCount++;
                    } else {
                        console.warn(`è·³éç¬¬ ${index + 1} é …ï¼šç¼ºå°‘ songName æˆ– artist`);
                        skippedCount++;
                    }
                });

                console.log(`è½‰æ›å®Œæˆ: ${processedCount} é¦–æˆåŠŸï¼Œ${skippedCount} é¦–è·³é`);
                return result;
            }

            displayResult(convertedData) {
                const jsonString = JSON.stringify(convertedData, null, 2);
                this.outputJson.textContent = jsonString;

                const songCount = Object.keys(convertedData).length;
                this.songCount.textContent = `${songCount} é¦–æ­Œæ›²`;

                this.downloadBtn.disabled = false;
                this.copyBtn.disabled = false;

                // å„²å­˜çµæœä¾›ä¸‹è¼‰ä½¿ç”¨
                this.convertedData = jsonString;
            }

            downloadFile() {
                if (!this.convertedData) {
                    this.showError('æ²’æœ‰å¯ä¸‹è¼‰çš„è³‡æ–™');
                    return;
                }

                const blob = new Blob([this.convertedData], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = 'songlist.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                URL.revokeObjectURL(url);

                this.showSuccess('æª”æ¡ˆå·²ä¸‹è¼‰ï¼è«‹æ‰‹å‹•æ›¿æ› worker/src/songlist.json');
            }

            async copyToClipboard() {
                if (!this.convertedData) {
                    this.showError('æ²’æœ‰å¯è¤‡è£½çš„è³‡æ–™');
                    return;
                }

                try {
                    await navigator.clipboard.writeText(this.convertedData);
                    this.showSuccess('å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
                } catch (err) {
                    // å‚™ç”¨æ–¹æ¡ˆ
                    const textArea = document.createElement('textarea');
                    textArea.value = this.convertedData;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);

                    this.showSuccess('å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼');
                }
            }

            clearInput() {
                this.inputJson.value = '';
                this.outputJson.textContent = 'è½‰æ›çµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡...';
                this.songCount.textContent = '0 é¦–æ­Œæ›²';
                this.downloadBtn.disabled = true;
                this.copyBtn.disabled = true;
                this.convertedData = null;
            }

            showError(message) {
                this.showAlert(message, 'danger');
            }

            showSuccess(message) {
                this.showAlert(message, 'success');
            }

            showAlert(message, type) {
                // ç§»é™¤ç¾æœ‰çš„ alert
                const existingAlert = document.querySelector('.alert-dismissible');
                if (existingAlert) {
                    existingAlert.remove();
                }

                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;

                const container = document.querySelector('.container');
                container.insertBefore(alertDiv, container.firstChild);

                // 3 ç§’å¾Œè‡ªå‹•ç§»é™¤
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 3000);
            }
        }

        // åˆå§‹åŒ–è½‰æ›å™¨
        document.addEventListener('DOMContentLoaded', () => {
            new SonglistConverter();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>